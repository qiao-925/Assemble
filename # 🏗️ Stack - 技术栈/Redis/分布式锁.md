# 🔒 **Redis分布式锁深度解析与最佳实践**

## 🏗️ **实现原理：（原子操作）**

SET命令和NX参数（如果不存在则set,否则跳过），使用完后，通过del指令释放锁

## 🔄 **改进历程：**

### 1️⃣ **为什么需要加过期时间？**

加锁后程序执行异常，del指令无法执行，陷入死锁状态。

### 2️⃣ **setnx命令和expire命令的原子性问题**

setnx命令执行后，程序异常，无法添加过期时间？

```
SET key value EX seconds NX
```

redis 2.8将两个命令合并为一个原子命令。

### 3️⃣ **过期时间小于程序的操作时间，如何处理？**

**程序的预计处理时间和过期时间的灵活控制（动态问题）**

- **手动处理**：对业务处理时间进行合理预估，控制过期时间和程序处理时间的平衡。
- **引入续约锁机制**：
    - Redission支持watch dog机制轮询（默认释放时间1/3）和更新（重置）锁的过期时间。
    - Redission问题：如果任务一直没完成，会导致极大的阻塞。