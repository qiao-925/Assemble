## 缓存的基本思想：空间换时间。

类似的还有

- 索引
- 字段冗余
- CDN

## 本地（客户端）缓存与分布式缓存

- 本地缓存特点
    - 无网络开销
    - 实现：HashMap，ConcurrentHashMap, Spring Cache / **Caffeine。**
    - 缺陷：内存耗费，分布式部署的共享，同步问题

在分布式环境下，本地缓存几乎只适合一些静态数据的缓存加速，rule-checker 缓存规则

- 分布式缓存特点
    - 缓存模块化，可对分布式系统提供更好的支持，共享，同步问题更容易解决
    - 实现：Redis，市场验证
    - 缺陷：复杂度上升，成本

## 为什么要用分布式缓存？

节点之间缓存的同步，共享问题。

## Redis客户端缓存特点 —— tracking 通知（default/broadcast）

- since redis 6.0
- Redis服务端本身不提供在应用端缓存数据的功能，它只负责在数据变更时发送通知。缓存的实现需要由客户端库（如 Redisson、Jedis 等）或应用本身来完成。
- 客户端缓存最大的挑战在于如何处理缓存失效，即当 Redis 中的数据发生变化时，如何确保客户端的本地缓存也能同步更新，避免返回脏数据。

### tracking 失效通知机制

**两种主要的追踪模式**

Redis 提供了两种主要的追踪模式，以适应不同的应用场景和资源权衡。[redis.io+1](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQEfLUB6IEeTW86GLdcgkuSiw_YmFjCDIyMIM4m3v3VXswRlakfPHFXwoCkFX-u0IkT5bd3zsYAm2ASLeKQYAq5OD4QlxFSIckr6fnkgIfCopaGu6LpGNtV-0Tll57D6lGDCxK48FUDx_-0b5iKJIj6WdNVTaFd08WUUeYp88JQ=)

| **特性** | **默认模式 (Default Mode)** | **广播模式 (Broadcast Mode)** |
| --- | --- | --- |
| **工作方式** | 服务端精确记录每个客户端请求过的每一个键。[tencent.com](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHcIvIP8hiv2FfaivVqmVO2EgsD4Hj6SIAd3qq-1J1rv55tnikfCJu0FxBhg0j8M5O_-Nx9p53tZnfYLhO23OwELZjaVefl9BLWZamhQvxW-MU2Lqs5-l18KbXwUY-VQ_YqJCNd1HqjB-VwukTGLQ==) | 客户端订阅感兴趣的键前缀（如 `user:` 或 `product:`）。[redis.io+1](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQEfLUB6IEeTW86GLdcgkuSiw_YmFjCDIyMIM4m3v3VXswRlakfPHFXwoCkFX-u0IkT5bd3zsYAm2ASLeKQYAq5OD4QlxFSIckr6fnkgIfCopaGu6LpGNtV-0Tll57D6lGDCxK48FUDx_-0b5iKJIj6WdNVTaFd08WUUeYp88JQ=) |
| **服务端内存** | 消耗内存较多，因为需要存储键和客户端的映射关系。[tencent.com](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHcIvIP8hiv2FfaivVqmVO2EgsD4Hj6SIAd3qq-1J1rv55tnikfCJu0FxBhg0j8M5O_-Nx9p53tZnfYLhO23OwELZjaVefl9BLWZamhQvxW-MU2Lqs5-l18KbXwUY-VQ_YqJCNd1HqjB-VwukTGLQ==) | 基本不消耗内存，只需记录前缀和客户端的订阅关系。[redis.io+1](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQEfLUB6IEeTW86GLdcgkuSiw_YmFjCDIyMIM4m3v3VXswRlakfPHFXwoCkFX-u0IkT5bd3zsYAm2ASLeKQYAq5OD4QlxFSIckr6fnkgIfCopaGu6LpGNtV-0Tll57D6lGDCxK48FUDx_-0b5iKJIj6WdNVTaFd08WUUeYp88JQ=) |
| **通知范围** | 精确，只向缓存了特定键的客户端发送失效通知。[tencent.com](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHcIvIP8hiv2FfaivVqmVO2EgsD4Hj6SIAd3qq-1J1rv55tnikfCJu0FxBhg0j8M5O_-Nx9p53tZnfYLhO23OwELZjaVefl9BLWZamhQvxW-MU2Lqs5-l18KbXwUY-VQ_YqJCNd1HqjB-VwukTGLQ==) | 范围较广，任何匹配前缀的键发生变化，都会通知所有订阅该前缀的客户端。[tencent.com](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHcIvIP8hiv2FfaivVqmVO2EgsD4Hj6SIAd3qq-1J1rv55tnikfCJu0FxBhg0j8M5O_-Nx9p53tZnfYLhO23OwELZjaVefl9BLWZamhQvxW-MU2Lqs5-l18KbXwUY-VQ_YqJCNd1HqjB-VwukTGLQ==) |
| **适用场景** | 适用于写操作不频繁，且希望最大限度减少无效通知的场景。 | 适用于写操作较多，或服务端内存资源紧张的场景。 |
|  |  |  |

默认：按键（少量）

广播：按前缀（大量键抽象为前缀） → 按需为同一个业务配置相同前缀

**客户端缓存应用分析 —— 适合读多写少，热点数据场景**